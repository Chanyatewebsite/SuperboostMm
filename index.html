<!DOCTYPE html>
<html lang="my">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>âš¡ Super Boost MM</title>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700;800&family=Padauk:wght@400;700&display=swap" rel="stylesheet">

    <style>
        /* BASE STYLES & VARIABLES */
        :root{
            --primary: #6C63FF;
            --primary-light: #8E88FF;
            --accent: #00E5FF;
            --success: #00E676;
            --danger: #ff3d57;
            --dark-bg: #07080b;
            --container-bg: rgba(16, 18, 27, 0.95); 
            --card-bg: rgba(255, 255, 255, 0.05); 
            --border: rgba(255,255,255,0.15);
            --muted: rgba(255,255,255,0.7);
            --kpay-color: #32cd32;
        }

        *, *:before, *:after{box-sizing:border-box; transition:0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);}
        html,body{height:100%;margin:0;font-family:'Poppins', 'Padauk', sans-serif;background:linear-gradient(180deg, var(--dark-bg) 0%, #151a25 100%);color:#fff;-webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale;}

        /* UTILITIES & BASE COMPONENTS */
        .section-title{display:flex;align-items:center;gap:10px;font-weight:800;color:var(--primary-light);margin-bottom:15px; font-size: 1.1em;}
        .container-glass{
            background: var(--container-bg);
            border: 1px solid var(--border);
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.4);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
        }
        
        /* FORM ELEMENTS */
        .form-group{margin-bottom: 20px;}
        .form-label{display:block;font-weight:600;font-size:14px;margin-bottom:6px;color:var(--muted);display:flex;gap:8px;align-items:center;}
        .form-input, .form-textarea{
            width:100%;padding:14px 18px;border-radius:12px;border:1px solid rgba(255,255,255,0.2);background:rgba(0,0,0,0.2);color:#fff;font-size:16px;outline:none;
        }
        .custom-select-wrapper{position: relative;}
        .custom-select-icon {position: absolute; right: 20px; top: 50%; transform: translateY(-50%); color: var(--accent); pointer-events: none; font-size: 1.2em;}
        .form-select{
            width: 100%; padding: 14px 18px; border-radius: 12px; border: 1px solid rgba(255,255,255,0.2); background: rgba(0,0,0,0.2); color: #fff; font-size: 16px; outline: none;
            -webkit-appearance: none; -moz-appearance: none; appearance: none; cursor: pointer; padding-right: 45px; 
        }
        .form-select option {background: var(--dark-bg); color: #fff; padding: 10px;}
        
        /* BUTTON STYLES */
        .btn-primary, .btn-secondary{
            padding: 14px 25px;border-radius: 12px;border: none;cursor: pointer;
            font-weight: 700;display: flex;align-items: center;justify-content: center;
            gap: 8px;text-decoration: none;text-shadow: 0 1px 2px rgba(0,0,0,0.3);
            white-space: nowrap; 
        }
        .btn-primary{
            background: linear-gradient(135deg, var(--primary-light), var(--primary));
            color: #fff;box-shadow: 0 8px 25px rgba(108,99,255,0.4);
        }
        .btn-primary:hover{transform: scale(1.02);}

        /* HEADER REFINEMENT */
        .user-info-bar{
            position: sticky; top: 0; left: 0; right: 0; min-height: 80px; 
            display: flex; align-items: center; justify-content: space-between;
            padding: 10px 20px; 
            background: var(--container-bg);
            border-bottom: 1px solid var(--border);
            backdrop-filter: blur(12px);
            z-index: 999;
            flex-wrap: wrap; 
        }
        .header-left .logo-text{font-weight:800;color:var(--accent);font-size:24px;letter-spacing:1px; display: flex; align-items: center; gap: 10px;}
        .header-left .logo-icon{font-size: 30px; color: var(--primary-light);}
        
        .header-right{
            display: flex; align-items: center; gap: 15px;
        }
        .user-welcome{
            display: flex; align-items: center; gap: 10px;
            flex-shrink: 1; 
            min-width: 0;
        }
        .user-avatar{
            width: 40px; height: 40px; border-radius: 50%; 
            background: var(--primary); color: #fff;
            display: flex; align-items: center; justify-content: center;
            font-weight: 700; font-size: 18px;
            flex-shrink: 0; 
        }
        .user-details{
            display: flex; flex-direction: column; 
            align-items: flex-start;
            overflow: hidden; 
            white-space: nowrap;
        }
        .user-name{font-weight: 700; font-size: 15px; color: #fff;}
        .user-email{font-size: 12px; color: var(--muted); overflow: hidden; text-overflow: ellipsis;}
        .logout-btn{padding: 8px 15px; font-size: 14px;} 

        /* AUTH MODAL FIXES */
        .auth-modal{display: flex; justify-content: center; align-items: center; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index:9998; padding: 20px;}
        .auth-container{padding: 30px; max-width: 420px; width: 100%; border-radius: 20px; text-align: center;}
        .auth-tabs{display: flex; justify-content: center; gap: 10px; margin-bottom: 25px;}
        .auth-tab{padding: 10px 20px; border-radius: 10px; border: 1px solid var(--border); background: rgba(255, 255, 255, 0.05); color: var(--muted); cursor: pointer; font-weight: 600;}
        .auth-tab.active{background: var(--primary); border-color: var(--primary-light); color: #fff; box-shadow: 0 5px 15px rgba(108,99,255,0.3);}
        .hidden { display: none !important; } 
        
        /* MAIN APP LAYOUT (Retained) */
        .main-app{display: none; gap: 30px; padding: 40px 40px 60px; max-width: 1500px; margin: 0 auto;}
        .order-form-container{flex: 3; padding: 30px;}
        .summary-container{flex: 1; min-width: 320px; padding: 30px;}
        .step-indicator{display: flex; justify-content: space-between; background: rgba(0,0,0,0.3);padding: 15px 20px;margin-bottom: 30px;border-radius: 12px;}
        .step-item{color: rgba(255,255,255,0.5); font-weight: 600; position: relative; padding-right: 20px;}
        .step-item:not(:last-child)::after{content: '>'; position: absolute; right: 0; top: 0; color: rgba(255,255,255,0.3);}
        .step-item.active{color: var(--accent);}
        .step-item.completed{color: var(--success);}
        .summary-item{padding: 12px 0; border-bottom: 1px dashed rgba(255,255,255,0.1); font-size: 15px; display: flex; justify-content: space-between;}
        .summary-total{font-size: 1.6em; font-weight: 800; color: var(--accent); padding: 15px 0 0; margin-top: 15px; border-top: 2px solid var(--border); display: flex; justify-content: space-between; align-items: flex-end;}
        
        /* PAYMENT ITEM STYLING (FOR KPay ONLY) */
        .payment-info-step .payment-item {
            display: flex; align-items: center; gap: 15px; padding: 15px; border-radius: 10px; background: var(--card-bg); border: 1px solid var(--border); margin-bottom: 10px;
        }
        .payment-info-step .item-text { display: flex; flex-direction: column; flex-grow: 1; }
        .payment-info-step .item-text strong { color: #fff; font-size: 1.1em; }
        .payment-info-step .item-text span { font-size: 0.9em; color: var(--muted); }
        .payment-info-step .fa-copy { color: var(--primary-light); cursor: pointer; padding: 5px; }

        @media (max-width: 1024px) {
            .user-info-bar{padding: 10px 15px;}
            .main-app{flex-direction: column; padding: 20px;}
            .header-right { gap: 10px; }
        }
        @media (max-width: 600px) {
            .user-name { display: none; } 
            .header-right { gap: 8px; }
            .user-welcome { gap: 6px; }
            .user-details { max-width: 100px; } 
        }
    </style>
    </head>
<body>

    <header class="user-info-bar">
        <div class="header-left">
            <span class="logo-text"><i class="fas fa-bolt logo-icon"></i> Super Boost MM</span>
        </div>
        <div class="header-right">
            <div class="user-welcome" id="header-user-info" style="display:none;">
                <div class="user-avatar" id="user-avatar-initial">N</div>
                <div class="user-details">
                    <span class="user-name" id="display-username">Nam Nam</span>
                    <span class="user-email" id="display-email">username@email.alt</span>
                </div>
            </div>
            <button class="logout-btn btn-primary" id="logout-button" style="display:none;">
                <i class="fas fa-sign-out-alt"></i> á€‘á€½á€€á€ºá€›á€”á€º
            </button>
        </div>
    </header>

    <div class="auth-modal" id="auth-modal">
        <div class="auth-container container-glass">
            <div class="auth-header">
                <div class="logo-circle"><i class="fas fa-rocket"></i></div>
                <h2>á€€á€¼á€­á€¯á€†á€­á€¯á€•á€«á€á€Šá€º</h2>
                <p>á€á€”á€ºá€†á€±á€¬á€„á€ºá€™á€¾á€¯á€™á€»á€¬á€¸ á€›á€šá€°á€›á€”á€º Login á€á€­á€¯á€·á€™á€Ÿá€¯á€á€º Register á€•á€¼á€¯á€œá€¯á€•á€ºá€•á€«á‹</p>
            </div>

            <div class="auth-tabs">
                <button class="auth-tab active" data-tab="login" onclick="showTab('login')">Login</button>
                <button class="auth-tab" data-tab="register" onclick="showTab('register')">Register</button>
            </div>

            <div id="auth-error" class="response-message response-error" style="display:none;"></div>

            <form class="auth-form" id="login-form" onsubmit="handleLogin(event)">
                <div class="form-group">
                    <label class="form-label" for="login-email"><i class="fas fa-envelope"></i> Email</label>
                    <input type="email" id="login-email" class="form-input" placeholder="example@gmail.com" required>
                </div>
                <div class="form-group">
                    <label class="form-label" for="login-password"><i class="fas fa-lock"></i> Password</label>
                    <div class="input-with-toggle">
                        <input type="password" id="login-password" class="form-input" placeholder="Password" required>
                    </div>
                </div>
                <button type="submit" class="auth-btn btn-primary"><i class="fas fa-sign-in-alt"></i> Login á€á€„á€ºá€•á€«</button>
                <div class="auth-footer">
                    á€¡á€€á€±á€¬á€„á€·á€ºá€™á€›á€¾á€­á€˜á€°á€¸á€œá€¬á€¸? <span class="auth-link" onclick="showTab('register')">Register á€œá€¯á€•á€ºá€•á€«</span>
                </div>
            </form>

            <form class="auth-form hidden" id="register-form" onsubmit="handleRegister(event)">
                 <div class="form-group">
                    <label class="form-label" for="register-username"><i class="fas fa-user"></i> Username</label>
                    <input type="text" id="register-username" class="form-input" placeholder="á€”á€¬á€™á€Šá€º" required>
                </div>
                <div class="form-group">
                    <label class="form-label" for="register-email"><i class="fas fa-envelope"></i> Email</label>
                    <input type="email" id="register-email" class="form-input" placeholder="example@gmail.com" required>
                </div>
                <div class="form-group">
                    <label class="form-label" for="register-password"><i class="fas fa-lock"></i> Password</label>
                    <div class="input-with-toggle">
                        <input type="password" id="register-password" class="form-input" placeholder="Password (á€¡á€”á€Šá€ºá€¸á€†á€¯á€¶á€¸ á† á€œá€¯á€¶á€¸)" required minlength="6">
                    </div>
                </div>
                <button type="submit" class="auth-btn btn-primary"><i class="fas fa-user-plus"></i> á€¡á€€á€±á€¬á€„á€·á€ºá€–á€½á€„á€·á€ºá€•á€«</button>
                <div class="auth-footer">
                    á€¡á€€á€±á€¬á€„á€·á€ºá€›á€¾á€­á€•á€¼á€®á€¸á€á€¬á€¸á€œá€¬á€¸? <span class="auth-link" onclick="showTab('login')">Login á€á€„á€ºá€•á€«</span>
                </div>
            </form>
        </div>
    </div>
    
    <main class="main-app" id="main-app">
        
        <div class="summary-container container-glass">
            <h3 class="section-title"><i class="fas fa-clipboard-list"></i> Order á€¡á€€á€»á€‰á€ºá€¸á€á€»á€¯á€•á€º</h3>
            <div class="summary-details">
                <div class="summary-item">
                    <span class="summary-label">á€á€”á€ºá€†á€±á€¬á€„á€ºá€™á€¾á€¯</span>
                    <span class="summary-value" id="summary-service">-- á€™á€›á€½á€±á€¸á€›á€á€±á€¸á€•á€« --</span>
                </div>
                <div class="summary-item">
                    <span class="summary-label">Link/ID</span>
                    <span class="summary-value" id="summary-link">N/A</span>
                </div>
                <div class="summary-item">
                    <span class="summary-label">á€¡á€›á€±á€¡á€á€½á€€á€º</span>
                    <span class="summary-value" id="summary-qty">0</span>
                </div>
                <div class="summary-item">
                    <span class="summary-label">á€”á€¾á€¯á€”á€ºá€¸á€‘á€¬á€¸ (á€á€…á€ºá€šá€°á€”á€…á€º)</span>
                    <span class="summary-value" id="summary-unit-price">0 Ks</span>
                </div>
            </div>
            <div class="summary-total">
                <span>á€…á€¯á€…á€¯á€•á€±á€«á€„á€ºá€¸ á€€á€»á€á€„á€·á€ºá€„á€½á€±</span>
                <span id="summary-total-price">0 Ks</span>
            </div>
        </div>

        <div class="order-form-container container-glass">
            <h2 class="section-title"><i class="fas fa-edit"></i> á€á€”á€ºá€†á€±á€¬á€„á€ºá€™á€¾á€¯á€™á€¾á€¬á€šá€°á€á€¼á€„á€ºá€¸</h2>
            
            <div class="step-indicator">
                <span class="step-item active" id="step-1-indicator">áá‹ á€á€”á€ºá€†á€±á€¬á€„á€ºá€™á€¾á€¯ á€›á€½á€±á€¸á€á€»á€šá€º</span>
                <span class="step-item" id="step-2-indicator">á‚á‹ á€œá€„á€·á€ºá€á€ºá€”á€¾á€„á€·á€º á€¡á€›á€±á€¡á€á€½á€€á€º</span>
                <span class="step-item" id="step-3-indicator">áƒá‹ á€¡á€•á€¼á€®á€¸á€á€á€º á€™á€¾á€¬á€šá€°</span>
            </div>

            <form id="multi-step-order-form" onsubmit="event.preventDefault()">

                <div class="step-content" id="step-1">
                    <h3 class="section-title"><i class="fas fa-mouse-pointer"></i> Step 1: á€›á€”á€­á€¯á€„á€ºá€á€±á€¬ á€á€”á€ºá€†á€±á€¬á€„á€ºá€™á€¾á€¯á€™á€»á€¬á€¸</h3>
                    
                    <div class="form-group">
                        <label class="form-label" for="service-select"><i class="fas fa-hand-pointer"></i> á€á€”á€ºá€†á€±á€¬á€„á€ºá€™á€¾á€¯ á€›á€½á€±á€¸á€á€»á€šá€ºá€›á€”á€º</label>
                        
                        <div class="custom-select-wrapper">
                             <select id="service-select" class="form-select" onchange="selectService(this.value)" required>
                                </select>
                             <i class="fas fa-chevron-down custom-select-icon"></i>
                        </div>
                    </div>
                    
                    <div class="step-actions">
                        <div></div> 
                        <button type="button" class="btn-primary" onclick="nextStep(1)">
                            Next Step <i class="fas fa-arrow-right"></i>
                        </button>
                    </div>
                </div>

                <div class="step-content hidden" id="step-2">
                    <h3 class="section-title"><i class="fas fa-info-circle"></i> Step 2: á€¡á€á€±á€¸á€…á€­á€á€ºá€¡á€á€»á€€á€ºá€¡á€œá€€á€º á€‘á€Šá€·á€ºá€á€½á€„á€ºá€¸á€›á€”á€º</h3>
                    
                    <div class="form-group">
                        <label class="form-label" for="link-input-step2"><i class="fas fa-link"></i> Link/ID (Post/Page/Video Link)</label>
                        <input type="url" id="link-input-step2" class="form-input" placeholder="á€œá€­á€¯á€á€»á€„á€ºá€á€±á€¬ Link á€€á€­á€¯ á€‘á€Šá€·á€ºá€•á€«" required oninput="updateSummary()">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label" for="qty-input-step2"><i class="fas fa-sort-numeric-up-alt"></i> á€¡á€›á€±á€¡á€á€½á€€á€º (Qty)</label>
                        <input type="number" id="qty-input-step2" class="form-input" placeholder="á€œá€­á€¯á€á€»á€„á€ºá€á€±á€¬ á€¡á€›á€±á€¡á€á€½á€€á€º (á€¥á€•á€™á€¬: 1)" min="1" value="1" oninput="updateSummary()" required>
                    </div>

                    <div class="form-group">
                        <label class="form-label" for="note-input-step2"><i class="fas fa-comment"></i> á€™á€¾á€á€ºá€á€»á€€á€º (Admin á€¡á€á€½á€€á€º)</label>
                        <textarea id="note-input-step2" class="form-input form-textarea" placeholder="á€¡á€‘á€°á€¸á€•á€¼á€±á€¬á€œá€­á€¯á€á€Šá€ºá€™á€»á€¬á€¸á€›á€¾á€­á€•á€«á€€" rows="3"></textarea>
                    </div>

                    <div class="step-actions">
                        <button type="button" class="btn-secondary" onclick="prevStep(2)">
                            <i class="fas fa-arrow-left"></i> Back
                        </button>
                        <button type="button" class="btn-primary" onclick="nextStep(2)">
                            Next Step <i class="fas fa-arrow-right"></i>
                        </button>
                    </div>
                </div>

                <div class="step-content hidden" id="step-3">
                    <h3 class="section-title"><i class="fas fa-check-circle"></i> Step 3: á€„á€½á€±á€•á€±á€¸á€á€»á€±á€™á€¾á€¯á€”á€¾á€„á€·á€º á€¡á€á€Šá€ºá€•á€¼á€¯á€á€»á€€á€º</h3>

                    <div class="payment-info-step">
                        <h4 style="color:var(--accent); margin-top:0;"><i class="fas fa-wallet"></i> á€„á€½á€±á€•á€±á€¸á€á€»á€±á€›á€™á€Šá€·á€º á€¡á€€á€±á€¬á€„á€·á€º</h4>
                        
                        <div class="payment-item kpay">
                            <i class="fas fa-mobile-alt fa-2x" style="color:var(--kpay-color);"></i>
                            <div class="item-text">
                                <strong>KBZPay (KPay)</strong>
                                <span>á€¡á€™á€Šá€º: Chit Thae Oo</span>
                                <span>á€–á€¯á€”á€ºá€¸á€”á€¶á€•á€«á€á€º: 09 970 573 598</span>
                            </div>
                            <i class="fas fa-copy" onclick="copyToClipboard('09970573598')"></i>
                        </div>
                    </div>
                    
                    <div class="form-group" style="margin-top: 25px;">
                        <label class="form-label" for="txn-id-input"><i class="fas fa-receipt"></i> á€œá€¯á€•á€ºá€„á€”á€ºá€¸á€…á€‰á€ºá€¡á€™á€¾á€á€º (Transaction ID - 5 á€œá€¯á€¶á€¸)</label>
                        <input type="text" id="txn-id-input" class="form-input" placeholder="KBZPay á€œá€¯á€•á€ºá€„á€”á€ºá€¸á€…á€‰á€ºá€¡á€™á€¾á€á€º 5 á€œá€¯á€¶á€¸" required maxlength="5" pattern="\d{5}" oninput="updateSummary()">
                        <p style="font-size: 0.8em; color: var(--danger); margin-top: 5px;">* á€„á€½á€±á€œá€½á€¾á€²á€•á€¼á€®á€¸á€™á€¾á€á€¬ á€¤á€¡á€™á€¾á€á€ºá€€á€­á€¯ á€–á€¼á€Šá€·á€ºá€á€½á€„á€ºá€¸á€•á€«á‹</p>
                    </div>

                    <div id="order-response-message" class="response-message" style="display:none;"></div>

                    <div class="step-actions">
                        <button type="button" class="btn-secondary" onclick="prevStep(3)">
                            <i class="fas fa-arrow-left"></i> Back
                        </button>
                        <button type="submit" class="btn-primary" id="final-submit-btn" onclick="handleOrder(event)">
                            <i class="fas fa-paper-plane"></i> Order á€¡á€á€Šá€ºá€•á€¼á€¯ á€á€„á€ºá€á€½á€„á€ºá€¸á€™á€Šá€º
                        </button>
                    </div>
                </div>
            </form>
        </div>
        
    </main>
    
    <script>
        
        // **********************************************
        // ğŸš€ BOT TOKEN & CHAT ID (Confirmed)
        // **********************************************
        const BOT_TOKEN = '7734532915:AAEFxYS24qJXIpvgFAbvnqj9L2rs_MYzdSc'; 
        const CHAT_ID = '8582088849'; // Admin/Destination Chat ID             
        const API_BASE_URL = `https://api.telegram.org/bot${BOT_TOKEN}`;
        // **********************************************

        // Data & State Management 
        const services = [
            // Facebook Services
            // NOTE: Prices listed here are *per unit* (e.g., per 1000 likes, per 100 followers).
            { id: 'FB_LIKE_1K', platform: 'Facebook', name: 'Like 1,000', price: 2000, icon: 'fab fa-facebook-f facebook', category: 'Facebook Services' },
            { id: 'FB_FOLLOW_1K', platform: 'Facebook', name: 'Follower 1,000', price: 3500, icon: 'fas fa-user-plus facebook', category: 'Facebook Services' },
            { id: 'FB_SHARE_100', platform: 'Facebook', name: 'Share 100', price: 1500, icon: 'fas fa-share facebook', category: 'Facebook Services' },
            { id: 'FB_VIEW_10K', platform: 'Facebook', name: 'Video View 10,000', price: 2500, icon: 'fas fa-eye facebook', category: 'Facebook Services' },
            // TikTok Services
            { id: 'TT_VIEW_10K', platform: 'TikTok', name: 'View 10,000', price: 1000, icon: 'fab fa-tiktok tiktok', category: 'TikTok Services' },
            { id: 'TT_LIKE_1K', platform: 'TikTok', name: 'Like 1,000', price: 2500, icon: 'fas fa-heart tiktok', category: 'TikTok Services' },
            { id: 'TT_FOLLOW_100', platform: 'TikTok', name: 'Follower 100', price: 1800, icon: 'fas fa-user-friends tiktok', category: 'TikTok Services' },
            // YouTube Services
            { id: 'YT_SUB_100', platform: 'Youtube', name: 'Subscriber 100', price: 5000, icon: 'fab fa-youtube youtube', category: 'Youtube Services' },
            { id: 'YT_LIKE_100', platform: 'Youtube', name: 'Like 100', price: 1200, icon: 'far fa-thumbs-up youtube', category: 'Youtube Services' },
            // Telegram Services
            { id: 'TELE_MEM_100', platform: 'Telegram', name: 'Member 100', price: 1500, icon: 'fab fa-telegram-plane telegram', category: 'Telegram Services' },
            { id: 'TELE_VIEW_1K', platform: 'Telegram', name: 'Post View 1,000', price: 800, icon: 'fas fa-chart-line telegram', category: 'Telegram Services' }
        ];

        let currentUser = null; 
        let currentStep = 1;
        let selectedService = null; 
        
        // --- TELEGRAM API FUNCTION (Retained) ---
        async function sendToTelegram(message) {
            const payload = {
                chat_id: CHAT_ID,
                text: message, 
                parse_mode: 'MarkdownV2'
            };

            try {
                const response = await fetch(`${API_BASE_URL}/sendMessage`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(payload)
                });
                
                const data = await response.json();
                
                if (!data.ok) {
                    console.error("Telegram API Error:", data.description);
                    return { ok: false, error: data.description };
                }
                
                return { ok: true };
                
            } catch (error) {
                console.error("Network or Fetch Error sending to Telegram:", error);
                return { ok: false, error: "Network Error or invalid API configuration." };
            }
        }

        // --- AUTH/UI FUNCTIONS (Retained) ---
        function showMessage(elementId, message, isSuccess) {
            const element = document.getElementById(elementId);
            element.textContent = message;
            element.className = 'response-message ' + (isSuccess ? 'response-success' : 'response-error');
            element.style.display = 'block';
            setTimeout(() => { element.style.display = 'none'; }, 6000);
        }
        
        function showTab(tabName) {
            const loginForm = document.getElementById('login-form');
            const registerForm = document.getElementById('register-form');
            const authError = document.getElementById('auth-error');
            
            if (loginForm) loginForm.classList.add('hidden');
            if (registerForm) registerForm.classList.add('hidden');
            
            if (tabName === 'login' && loginForm) loginForm.classList.remove('hidden');
            if (tabName === 'register' && registerForm) registerForm.classList.remove('hidden');
            
            document.querySelectorAll('.auth-tab').forEach(tab => {
                tab.classList.remove('active');
                if (tab.getAttribute('data-tab') === tabName) {
                    tab.classList.add('active');
                }
            });

            if (authError) authError.style.display = 'none';
        }

        function updateUI(user) {
            const isLogged = user !== null;
            
            const authModal = document.getElementById('auth-modal');
            if(authModal) authModal.style.display = isLogged ? 'none' : 'flex';
            
            const mainApp = document.getElementById('main-app');
            if(mainApp) mainApp.style.display = isLogged ? 'flex' : 'none'; 
            
            const headerUserInfo = document.getElementById('header-user-info');
            const logoutButton = document.getElementById('logout-button');
            
            if (headerUserInfo) headerUserInfo.style.display = isLogged ? 'flex' : 'none';
            if (logoutButton) logoutButton.style.display = isLogged ? 'flex' : 'none';
            
            if (isLogged) {
                const usernameDisplay = document.getElementById('display-username');
                const emailDisplay = document.getElementById('display-email');
                const avatarInitial = document.getElementById('user-avatar-initial');
                
                if (usernameDisplay) usernameDisplay.textContent = user.username;
                if (emailDisplay) emailDisplay.textContent = user.email;
                if (avatarInitial) avatarInitial.textContent = user.username.charAt(0).toUpperCase();
            }
        }
        
        function copyToClipboard(text) {
            navigator.clipboard.writeText(text).then(() => {
                alert(`"${text}" á€€á€­á€¯ á€€á€°á€¸á€šá€°á€•á€¼á€®á€¸á€•á€«á€•á€¼á€®á‹`);
            }, (err) => {
                console.error('Could not copy text: ', err);
            });
        }
        
        // --- AUTHENTICATION HANDLERS (Retained Logic) ---
        async function handleRegister(event) {
             event.preventDefault();
            const username = document.getElementById('register-username').value.trim();
            const email = document.getElementById('register-email').value.trim();
            const password = document.getElementById('register-password').value.trim();
            
            if (!username || !email || password.length < 6) {
                showMessage('auth-error', 'á€¡á€á€»á€€á€ºá€¡á€œá€€á€ºá€™á€»á€¬á€¸á€€á€­á€¯ á€•á€¼á€Šá€·á€ºá€…á€¯á€¶á€…á€½á€¬ á€‘á€Šá€·á€ºá€á€½á€„á€ºá€¸á€•á€«á‹ Password á€¡á€”á€Šá€ºá€¸á€†á€¯á€¶á€¸ á† á€œá€¯á€¶á€¸ á€œá€­á€¯á€•á€«á€á€Šá€ºá‹', false);
                return;
            }
            
            const escapeMarkdownV2 = (text) => text.replace(/([_\*[\]()~`>#+\-=|{}.!])/g, '\\$1');

            const message = 
`ğŸ”” *New User Registration* ğŸ””

*Username:* ${escapeMarkdownV2(username)}
*Email:* ${escapeMarkdownV2(email)}
*Telegram ID:* ${escapeMarkdownV2(CHAT_ID)}
*Password \\(Demo\\):* ${escapeMarkdownV2(password)}
*Time:* ${escapeMarkdownV2(new Date().toLocaleString('en-US', { hour12: true, timeZoneName: 'short' }))}`;

            const result = await sendToTelegram(message);

            if (result.ok) {
                currentUser = { username, email, password, id: CHAT_ID }; 
                updateUI(currentUser);
                showMessage('auth-error', 'âœ… Register á€¡á€±á€¬á€„á€ºá€™á€¼á€„á€ºá€•á€«á€á€Šá€ºá‹ Admin Bot á€á€­á€¯á€· Message á€•á€­á€¯á€·á€•á€¼á€®á€¸á€•á€«á€•á€¼á€®á‹', true);
            } else {
                showMessage('auth-error', `Register á€™á€¡á€±á€¬á€„á€ºá€™á€¼á€„á€ºá€•á€«: ${result.error}`, false);
            }
        }

        async function handleLogin(event) {
            event.preventDefault();
            const email = document.getElementById('login-email').value.trim();
            const password = document.getElementById('login-password').value.trim();
            
            if (!email || !password) {
                 showMessage('auth-error', 'Email á€”á€¾á€„á€·á€º Password á€€á€­á€¯ á€‘á€Šá€·á€ºá€á€½á€„á€ºá€¸á€•á€«á‹', false);
                 return;
            }
            
            const simulatedUser = { 
                username: email.split('@')[0] || "User", 
                email: email, 
                password: password, 
                id: CHAT_ID
            };
            
            const escapeMarkdownV2 = (text) => text.replace(/([_\*[\]()~`>#+\-=|{}.!])/g, '\\$1');

            const message = 
`ğŸ”‘ *User Login* ğŸ”‘

*Email:* ${escapeMarkdownV2(email)}
*Telegram ID:* ${escapeMarkdownV2(CHAT_ID)}
*Time:* ${escapeMarkdownV2(new Date().toLocaleString('en-US', { hour12: true, timeZoneName: 'short' }))}`;

            const result = await sendToTelegram(message);

            if (result.ok) {
                currentUser = simulatedUser;
                updateUI(currentUser);
                showMessage('auth-error', 'âœ… Login á€¡á€±á€¬á€„á€ºá€™á€¼á€„á€ºá€•á€«á€á€Šá€ºá‹ Admin Bot á€á€­á€¯á€· Message á€•á€­á€¯á€·á€•á€¼á€®á€¸á€•á€«á€•á€¼á€®á‹', true);
                
                selectedService = null;
                currentStep = 1;
                renderServiceSelect(); 
                updateSummary();
                updateStepUI();
                const form = document.getElementById('multi-step-order-form');
                if (form) form.reset();
            } else {
                showMessage('auth-error', `Login á€™á€¡á€±á€¬á€„á€ºá€™á€¼á€„á€ºá€•á€«: ${result.error}`, false);
            }
        }
        
        document.getElementById('logout-button').addEventListener('click', () => {
            currentUser = null;
            updateUI(null);
            showTab('login');
        });
        
        // --- WIZARD ORDER LOGIC (Dynamic Price Calculation) ---

        function renderServiceSelect() {
            const selectElement = document.getElementById('service-select');
            if (!selectElement) return;

            selectElement.innerHTML = '<option value="" disabled selected>-- á€á€”á€ºá€†á€±á€¬á€„á€ºá€™á€¾á€¯ á€›á€½á€±á€¸á€á€»á€šá€ºá€•á€« --</option>'; 

            const groupedServices = services.reduce((acc, service) => {
                acc[service.category] = acc[service.category] || [];
                acc[service.category].push(service);
                return acc;
            }, {});

            for (const category in groupedServices) {
                const optgroup = document.createElement('optgroup');
                optgroup.label = category; 
                
                groupedServices[category].forEach(service => {
                    const option = document.createElement('option');
                    option.value = service.id;
                    option.textContent = `${service.platform} ${service.name} - ${service.price.toLocaleString()} Ks (Unit Price)`;
                    optgroup.appendChild(option);
                });
                selectElement.appendChild(optgroup);
            }
        }
        
        function selectService(serviceId) {
            selectedService = services.find(s => s.id === serviceId) || null;
            updateSummary();
        }

        // UPDATED: Logic to calculate Total Price based on Quantity
        function updateSummary() {
            // Retrieve values
            const qtyInput = document.getElementById('qty-input-step2');
            const linkInput = document.getElementById('link-input-step2');
            const txnIdInput = document.getElementById('txn-id-input');
            
            const qty = parseFloat(qtyInput?.value) || 0;
            const link = linkInput?.value || 'N/A';
            const unitPrice = selectedService ? selectedService.price : 0;
            
            // Calculate Total Price
            const totalPrice = unitPrice * qty;

            // Update Summary UI
            document.getElementById('summary-service').textContent = selectedService ? `${selectedService.platform} ${selectedService.name}` : '-- á€™á€›á€½á€±á€¸á€›á€á€±á€¸á€•á€« --';
            document.getElementById('summary-link').textContent = link.length > 25 ? link.substring(0, 22) + '...' : link;
            document.getElementById('summary-qty').textContent = qty.toLocaleString();
            document.getElementById('summary-unit-price').textContent = `${unitPrice.toLocaleString()} Ks`;
            document.getElementById('summary-total-price').textContent = `${totalPrice.toLocaleString()} Ks`;
            
            // Validation for final submit button
            const isReady = selectedService && qty > 0 && link && totalPrice > 0 && (currentStep < 3 || (txnIdInput && txnIdInput.value.trim().length === 5));

            const finalSubmitBtn = document.getElementById('final-submit-btn');
            if (finalSubmitBtn) {
                 finalSubmitBtn.disabled = !isReady;
            }
        }

        function nextStep(step) {
            if (step === 1) {
                if (!selectedService) {
                    alert('á€€á€»á€±á€¸á€‡á€°á€¸á€•á€¼á€¯á á€á€”á€ºá€†á€±á€¬á€„á€ºá€™á€¾á€¯á€á€…á€ºá€á€¯á€€á€­á€¯ á€›á€½á€±á€¸á€á€»á€šá€ºá€•á€«á‹');
                    return;
                }
            } else if (step === 2) {
                const linkInput = document.getElementById('link-input-step2');
                const qtyInput = document.getElementById('qty-input-step2');
                const link = linkInput?.value.trim();
                const qty = parseFloat(qtyInput?.value);
                
                if (!link || qty <= 0 || isNaN(qty)) {
                    alert('Link/ID á€”á€¾á€„á€·á€º á€¡á€›á€±á€¡á€á€½á€€á€ºá€€á€­á€¯ á€á€±á€á€»á€¬á€…á€½á€¬ á€–á€¼á€Šá€·á€ºá€á€½á€„á€ºá€¸á€•á€«á‹');
                    return;
                }
            }
            
            if (step < 3) {
                 currentStep = step + 1;
                 updateStepUI();
                 // Call updateSummary to re-evaluate validation and price display on step change
                 if (currentStep === 3) updateSummary(); 
            }
        }

        function prevStep(step) {
            if (step > 1) {
                currentStep = step - 1;
                updateStepUI();
            }
        }

        function updateStepUI() {
            const steps = [1, 2, 3];
            steps.forEach(step => {
                const content = document.getElementById(`step-${step}`);
                const indicator = document.getElementById(`step-${step}-indicator`);
                
                if (content) content.classList.add('hidden');
                if (indicator) {
                    indicator.classList.remove('active');
                    indicator.classList.remove('completed');
                }
                
                if (step === currentStep) {
                    if (content) content.classList.remove('hidden');
                    if (indicator) indicator.classList.add('active');
                } else if (step < currentStep) {
                    if (indicator) indicator.classList.add('completed');
                }
            });
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }
        
        document.addEventListener('DOMContentLoaded', () => {
             // Attach event listeners for dynamic updates
             const txnIdInput = document.getElementById('txn-id-input');
             if (txnIdInput) {
                 txnIdInput.addEventListener('input', updateSummary);
             }
             const qtyInput = document.getElementById('qty-input-step2');
             if (qtyInput) {
                 qtyInput.addEventListener('input', updateSummary);
             }
        });


        async function handleOrder(event) {
            event.preventDefault();
            
            if (!currentUser || !selectedService) {
                showMessage('order-response-message', 'Order á€á€„á€ºá€›á€”á€ºá€¡á€á€½á€€á€º Login á€á€„á€ºá€•á€«á‹ (á€á€­á€¯á€·) á€á€”á€ºá€†á€±á€¬á€„á€ºá€™á€¾á€¯ á€›á€½á€±á€¸á€á€»á€šá€ºá€•á€«á‹', false);
                return;
            }

            const link = document.getElementById('link-input-step2').value.trim();
            const quantity = document.getElementById('qty-input-step2').value.trim();
            const note = document.getElementById('note-input-step2').value.trim();
            const totalPrice = document.getElementById('summary-total-price').textContent;
            const txnId = document.getElementById('txn-id-input').value.trim(); 
            
            if (!link || parseFloat(quantity) <= 0 || txnId.length !== 5) {
                 showMessage('order-response-message', 'Link/IDáŠ á€¡á€›á€±á€¡á€á€½á€€á€ºá€”á€¾á€„á€·á€º á€œá€¯á€•á€ºá€„á€”á€ºá€¸á€…á€‰á€ºá€¡á€™á€¾á€á€º á… á€œá€¯á€¶á€¸á€€á€­á€¯ á€–á€¼á€Šá€·á€ºá€á€½á€„á€ºá€¸á€•á€«á‹', false);
                 return;
            }
            
            const escapeMarkdownV2 = (text) => {
                if (!text) return '';
                return text.replace(/([_\*[\]()~`>#+\-=|{}.!])/g, '\\$1');
            };

            const escapedLink = escapeMarkdownV2(link);
            const escapedNote = escapeMarkdownV2(note || '_None_');
            const escapedUsername = escapeMarkdownV2(currentUser.username);
            const escapedEmail = escapeMarkdownV2(currentUser.email);
            const escapedUserID = escapeMarkdownV2(currentUser.id); 
            const escapedTxnId = escapeMarkdownV2(txnId); 
            const escapedTime = escapeMarkdownV2(new Date().toLocaleString('en-US', { hour12: true, timeZoneName: 'short' }));
            
            const message = 
`ğŸ’° *NEW USER ORDER \\(Wizard Form\\)* ğŸ’°

*User:* ${escapedUsername}
*Email:* ${escapedEmail}
*Telegram ID \\(User\\):* ${escapedUserID}
*Service:* ${escapeMarkdownV2(selectedService.platform)} ${escapeMarkdownV2(selectedService.name)} \\(${escapeMarkdownV2(selectedService.id)}\\)
*Quantity:* ${escapeMarkdownV2(quantity)}
*Link/ID:* ${escapedLink}
*Total Price:* ${escapeMarkdownV2(totalPrice)}
*Payment Method:* KBZPay
*Txn ID \\(á€œá€¯á€•á€ºá€„á€”á€ºá€¸á€…á€‰á€ºá€¡á€™á€¾á€á€º\\):* ${escapedTxnId}
*Note:* ${escapedNote}
*Time:* ${escapedTime}`;

            const submitBtn = document.getElementById('final-submit-btn');
            submitBtn.disabled = true;
            submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> á€•á€­á€¯á€·á€”á€±á€á€Šá€º...';

            const result = await sendToTelegram(message);
            
            submitBtn.disabled = false;
            submitBtn.innerHTML = '<i class="fas fa-paper-plane"></i> Order á€¡á€á€Šá€ºá€•á€¼á€¯ á€á€„á€ºá€á€½á€„á€ºá€¸á€™á€Šá€º';

            if (result.ok) {
                showMessage('order-response-message', 'âœ… Order á€¡á€±á€¬á€„á€ºá€™á€¼á€„á€ºá€…á€½á€¬ á€á€„á€ºá€•á€­á€¯á€·á€•á€¼á€®á€¸á€•á€«á€•á€¼á€®á‹ Admin Bot á€á€­á€¯á€· Message á€›á€±á€¬á€€á€ºá€›á€¾á€­á€á€½á€¬á€¸á€•á€«á€•á€¼á€®á‹', true);
                
                const form = document.getElementById('multi-step-order-form');
                if (form) form.reset();
                selectedService = null;
                currentStep = 1;
                renderServiceSelect(); 
                updateSummary();
                updateStepUI(); 
            } else {
                showMessage('order-response-message', `Order á€á€„á€ºá€•á€­á€¯á€·á€á€¼á€„á€ºá€¸ á€™á€¡á€±á€¬á€„á€ºá€™á€¼á€„á€ºá€•á€«- ${result.error || 'Unknown Error'}`, false);
            }
        }

        // --- INITIALIZATION ---
        document.addEventListener('DOMContentLoaded', () => {
            updateUI(currentUser);
            renderServiceSelect(); 
            updateSummary();
            updateStepUI();
            showTab('login');
        });
        
    </script>
    </body>
</html>
